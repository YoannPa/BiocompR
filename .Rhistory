rnb.set <- create_cohort_rnbset(cohort.name = i)
cat("\tPlotting methylation heatmap of genotyping probes SNP-CpGs...\n")
#Define palette size
palette <- colorRampPalette(colors = palette)(length(unique(
HM450K_cohorts[[i]]$ICGC_Donor_ID)))
snp.heatmap(
RnBSet = rnb.set,
annot.grps = list("Donors" = HM450K_cohorts[[i]]$ICGC_Donor_ID),
annot.pal = palette, heatmap.pal = pal_meth,
x.lab = "HM450K samples barcodes", plot.title = paste(
"Methylation heatmap of HM450K genotyping probes in", i, "cohort"),
annot.size = 1.2, dend.size = c(0.5, 2))
snp.heatmap(
RnBSet = rnb.set,
annot.grps = list("Donors" = HM450K_cohorts[[i]]$ICGC_Donor_ID),
annot.pal = palette, heatmap.pal = pal_meth,
x.lab = "HM450K samples barcodes", plot.title = paste(
"Methylation heatmap of HM450K genotyping probes in", i, "cohort"),
annot.size = 1.2, dend.size = c(0.3, 2))
snp.heatmap(
RnBSet = rnb.set,
annot.grps = list("Donors" = HM450K_cohorts[[i]]$ICGC_Donor_ID),
annot.pal = palette, heatmap.pal = pal_meth,
x.lab = "HM450K samples barcodes", plot.title = paste(
"Methylation heatmap of HM450K genotyping probes in", i, "cohort"),
annot.size = 1.2, dend.size = c(0.1, 2))
snp.heatmap(
RnBSet = rnb.set,
annot.grps = list("Donors" = HM450K_cohorts[[i]]$ICGC_Donor_ID),
annot.pal = palette, heatmap.pal = pal_meth,
x.lab = "HM450K samples barcodes", plot.title = paste(
"Methylation heatmap of HM450K genotyping probes in", i, "cohort"),
annot.size = 1.2, dend.size = c(0.05, 2))
snp.heatmap <- snp.heatmap(
RnBSet = rnb.set,
annot.grps = list("Donors" = HM450K_cohorts[[i]]$ICGC_Donor_ID),
annot.pal = palette, heatmap.pal = pal_meth,
x.lab = "HM450K samples barcodes", plot.title = paste(
"Methylation heatmap of HM450K genotyping probes in", i, "cohort"),
annot.size = 1.2, dend.size = c(0.05, 2))
#Set width
if(length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) > 30){
if(length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) <= 40 &
length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) >= 31){
plot_width <- 43
} else {
plot_width <- length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) - 5
}
} else { plot_width <- 25 }
#TODO: loop over device type (png & pdf).
#Save heatmap as pdf
ggsave(filename = paste(
"Heatmap", "Genotyping", "Probes", "HM450K", paste0(i, ".pdf"), sep = "_"),
plot = snp.heatmap, device = "pdf",
path = "PCAWG_Paper/graphs/Heatmap_Genotyping_Probes/", width = plot_width,
height = 27, units = "cm", limitsize = FALSE)
#Save heatmap as png
ggsave(filename = paste(
"Heatmap", "Genotyping", "Probes", "HM450K", paste0(i, ".png"), sep = "_"),
plot = snp.heatmap, device = "png",
path = "PCAWG_Paper/graphs/Heatmap_Genotyping_Probes/", width = plot_width,
height = 27, units = "cm", limitsize = FALSE)
cat("\tDone.\n")
snp.heatmap <- snp.heatmap(
RnBSet = rnb.set,
annot.grps = list("Donors" = HM450K_cohorts[[i]]$ICGC_Donor_ID),
annot.pal = palette, heatmap.pal = pal_meth,
x.lab = "HM450K samples barcodes", plot.title = paste(
"Methylation heatmap of HM450K genotyping probes in", i, "cohort"),
annot.size = 1.2, dend.size = c(0.01, 2))
#Set width
if(length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) > 30){
if(length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) <= 40 &
length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) >= 31){
plot_width <- 43
} else {
plot_width <- length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) - 5
}
} else { plot_width <- 25 }
#TODO: loop over device type (png & pdf).
#Save heatmap as pdf
ggsave(filename = paste(
"Heatmap", "Genotyping", "Probes", "HM450K", paste0(i, ".pdf"), sep = "_"),
plot = snp.heatmap, device = "pdf",
path = "PCAWG_Paper/graphs/Heatmap_Genotyping_Probes/", width = plot_width,
height = 27, units = "cm", limitsize = FALSE)
#Save heatmap as png
ggsave(filename = paste(
"Heatmap", "Genotyping", "Probes", "HM450K", paste0(i, ".png"), sep = "_"),
plot = snp.heatmap, device = "png",
path = "PCAWG_Paper/graphs/Heatmap_Genotyping_Probes/", width = plot_width,
height = 27, units = "cm", limitsize = FALSE)
cat("\tDone.\n")
snp.heatmap <- snp.heatmap(
RnBSet = rnb.set,
annot.grps = list("Donors" = HM450K_cohorts[[i]]$ICGC_Donor_ID),
annot.pal = palette, heatmap.pal = pal_meth,
x.lab = "HM450K samples barcodes", plot.title = paste(
"Methylation heatmap of HM450K genotyping probes in", i, "cohort"),
annot.size = 1.2, dend.size = c(0.001, 2))
#Set width
if(length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) > 30){
if(length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) <= 40 &
length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) >= 31){
plot_width <- 43
} else {
plot_width <- length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) - 5
}
} else { plot_width <- 25 }
#TODO: loop over device type (png & pdf).
#Save heatmap as pdf
ggsave(filename = paste(
"Heatmap", "Genotyping", "Probes", "HM450K", paste0(i, ".pdf"), sep = "_"),
plot = snp.heatmap, device = "pdf",
path = "PCAWG_Paper/graphs/Heatmap_Genotyping_Probes/", width = plot_width,
height = 27, units = "cm", limitsize = FALSE)
snp.heatmap(
RnBSet = rnb.set,
annot.grps = list("Donors" = HM450K_cohorts[[i]]$ICGC_Donor_ID),
annot.pal = palette, heatmap.pal = pal_meth,
x.lab = "HM450K samples barcodes", plot.title = paste(
"Methylation heatmap of HM450K genotyping probes in", i, "cohort"),
annot.size = 1.2, dend.size = c(0.001, 2))
##IMPORTS
Imports = c("RnBeads", "BiocompR")
invisible(lapply(Imports, library, character.only = T))
##FUNCTIONS
#' Draws a methylation heatmap from methylation of the 65 HM450K genotyping
#' probes.
#'
#' @param RnBSet             A \code{RnBSet} basic object for storing HM450K DNA
#'                           methylation and experimental quality information
#'                           (MethylationEPIC & Bisulfite data not supported).
#' @param dist.method        A \code{character} vector to specify the distance
#'                           methods to be used on the matrix rows and columns.
#'                           \itemize{
#'                            \item{If the vector is of length 1: the given
#'                                  method will be applied on rows and columns
#'                                  of the matrix.}
#'                            \item{If the vector is of length 2: the first
#'                                  method will be applied on matrix rows, and
#'                                  the second method will be applied on matrix
#'                                  columns.}
#'                           }
#'                           (Default: dist.method = 'manhattan';
#'                           Supported: dist.method = c('euclidean', 'maximum',
#'                           'manhattan', 'canberra', 'binary', 'minkowski',
#'                           'none')).
#' @param annot.grps         A \code{list} of vectors of groups to which
#'                           variables belongs for the annotation sidebars.
#'                           Vectors' lengths have to match the number of
#'                           variables.
#' @param annot.pal          A \code{vector} or a list of vectors containing
#'                           colors as characters for the annotation sidebars.
#'                           The length of vectors has to match the number of
#'                           levels of vectors listed in 'annot.grps'.
#'                           \itemize{
#'                            \item{If annot.pal is a list: its length must
#'                                  match the length of the list provided to
#'                                  'annot.grps'.}
#'                            \item{If annot.pal is a vector: make sure that the
#'                                  levels content of annotations listed in
#'                                  'annot.grps' is the same, and that no
#'                                  annotation contains less or more levels than
#'                                  another one in 'annot.grps'.}
#'                           }
#' @param heatmap.pal        A \code{character} vector to be used as a color
#'                           palette for the heatmap.
#' @param x.lab              A \code{character} to specify X-axis title
#'                           (Default: x.lab = 'Samples').
#' @param plot.title         A \code{character} to be used as title for the
#'                           plot.
#' @param axis.text.x        An \code{element_text} object to setup X axis text
#'                           (Default: axis.text.x = element_text(size = 10,
#'                           angle = -45, hjust = 0, vjust = 0.5,
#'                           color = "black")).
#' @param axis.text.y.right  An \code{element_text} object to setup right Y axis
#'                           text (Default: axis.text.y.right =
#'                           element_text(size = 7, color = "black")).
#' @param axis.title.y.right An \code{element_text} object to setup right Y axis
#'                           title
#'                           (Default: axis.title.y.right =
#'                           element_text(size = 11)).
#' @param lgd.text           An \code{element_text} object to setup legend
#'                           labels (Default: lgd.text =
#'                           element_text(size = 10)).
#' @param annot.size         A \code{numeric} defining the width of the
#'                           annotation bars (Default: annot.size = 1).
#' @param dend.col.size      A \code{numeric} defining the height of the
#'                           dendrogram made on columns
#'                           (Default: dend.col.size = 1).
#' @return A \code{grob} of the methylation heatmap created on HM450K genotyping
#'         probes.
#' @author Yoann Pageaud.
#' @export
#' @references Pageaud Y. et al., BiocompR - Advanced visualizations for data
#'             comparison.
snp.heatmap <- function(
RnBSet, dist.method = "manhattan", annot.grps, annot.pal, heatmap.pal,
x.lab = "Samples", plot.title, axis.text.x = element_text(
size = 10, angle = -45, hjust = 0, vjust = 0.5, color = "black"),
axis.text.y.right = element_text(size = 7, color = "black"),
axis.title.y.right = element_text(size = 11),
lgd.text = element_text(size = 10), annot.size = 1, dend.size = 1){
#Get the 65 genotyping (rs) probes
rs.probes <- rownames(RnBSet@sites)[
grepl(pattern = "rs", x = rownames(RnBSet@sites))]
#Extract methylation matrix from RnBSet
meth.mat <- meth(RnBSet, row.names = TRUE)
rs.meth.mat <- meth.mat[rs.probes, ]
#Plot SNP CpG heatmap using genotyping probes from HM450K data
snp.heatmap <- gg2heatmap(
m = rs.meth.mat, dist.method = dist.method, row.type = "genotyping probes",
y.lab = "HM450K genotyping probes", x.lab = x.lab,
axis.text.y.right = axis.text.y.right,
axis.ticks.y.right = element_line(color = "black"),
axis.text.x = axis.text.x, axis.title.y.right = axis.title.y.right,
annot.grps = annot.grps, annot.pal = annot.pal,
lgd.scale.name = "Methylation", lgd.text = lgd.text,
annot.size = annot.size, dend.size = dend.size,
heatmap.pal = heatmap.pal, dendrograms = TRUE, y.axis.right = TRUE,
plot.title = plot.title)
return(snp.heatmap)
}
snp.heatmap(
RnBSet = rnb.set,
annot.grps = list("Donors" = HM450K_cohorts[[i]]$ICGC_Donor_ID),
annot.pal = palette, heatmap.pal = pal_meth,
x.lab = "HM450K samples barcodes", plot.title = paste(
"Methylation heatmap of HM450K genotyping probes in", i, "cohort"),
annot.size = 1.2, dend.size = c(0.001, 2))
snp.heatmap(
RnBSet = rnb.set,
annot.grps = list("Donors" = HM450K_cohorts[[i]]$ICGC_Donor_ID),
annot.pal = palette, heatmap.pal = pal_meth,
x.lab = "HM450K samples barcodes", plot.title = paste(
"Methylation heatmap of HM450K genotyping probes in", i, "cohort"),
annot.size = 1.2, dend.size = c(-0.5, 2))
snp.htmp <- snp.heatmap(
RnBSet = rnb.set,
annot.grps = list("Donors" = HM450K_cohorts[[i]]$ICGC_Donor_ID),
annot.pal = palette, heatmap.pal = pal_meth,
x.lab = "HM450K samples barcodes", plot.title = paste(
"Methylation heatmap of HM450K genotyping probes in", i, "cohort"),
annot.size = 1.2, dend.size = c(-0.5, 2))
#Set width
if(length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) > 30){
if(length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) <= 40 &
length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) >= 31){
plot_width <- 43
} else {
plot_width <- length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) - 5
}
} else { plot_width <- 25 }
#TODO: loop over device type (png & pdf).
#Save heatmap as pdf
ggsave(filename = paste(
"Heatmap", "Genotyping", "Probes", "HM450K", paste0(i, ".pdf"), sep = "_"),
plot = snp.htmp, device = "pdf",
path = "PCAWG_Paper/graphs/Heatmap_Genotyping_Probes/", width = plot_width,
height = 27, units = "cm", limitsize = FALSE)
#Save heatmap as png
ggsave(filename = paste(
"Heatmap", "Genotyping", "Probes", "HM450K", paste0(i, ".png"), sep = "_"),
plot = snp.htmp, device = "png",
path = "PCAWG_Paper/graphs/Heatmap_Genotyping_Probes/", width = plot_width,
height = 27, units = "cm", limitsize = FALSE)
cat("\tDone.\n")
names(HM450K_cohorts)
cat("\tPlotting methylation heatmap of genotyping probes SNP-CpGs...\n")
#Define palette size
palette <- colorRampPalette(colors = palette)(length(unique(
HM450K_cohorts[[i]]$ICGC_Donor_ID)))
if(i %in% c("CLLE-ES", "LIRI-JP", "OV-AU", "PBCA-DE")){ dend.size.row <- -0.5
} else { dend.size.row <- 1 }
snp.htmp <- snp.heatmap(
RnBSet = rnb.set,
annot.grps = list("Donors" = HM450K_cohorts[[i]]$ICGC_Donor_ID),
annot.pal = palette, heatmap.pal = pal_meth,
x.lab = "HM450K samples barcodes", plot.title = paste(
"Methylation heatmap of HM450K genotyping probes in", i, "cohort"),
annot.size = 1.2, dend.size = c(dend.size.row, 2))
cat("\tPlotting methylation heatmap of genotyping probes SNP-CpGs...\n")
#Define palette size
palette <- colorRampPalette(colors = palette)(length(unique(
HM450K_cohorts[[i]]$ICGC_Donor_ID)))
if(i %in% c("CLLE-ES", "LIRI-JP", "OV-AU", "PBCA-DE")){ dend.size.row <- -0.5
} else { dend.size.row <- 1 }
snp.htmp <- snp.heatmap(
RnBSet = rnb.set,
annot.grps = list("Donors" = HM450K_cohorts[[i]]$ICGC_Donor_ID),
annot.pal = palette, heatmap.pal = pal_meth,
x.lab = "HM450K samples barcodes", plot.title = paste(
"Methylation heatmap of HM450K genotyping probes in", i, "cohort"),
annot.size = 1.2, dend.size = c(dend.size.row, 2))
i = names(HM450K_cohorts)[1]
cat(paste0("Cohort ", i, ":\n"))
#Execute data import with RnBeads
rnb.set <- create_cohort_rnbset(cohort.name = i)
cat("\tPlotting methylation heatmap of genotyping probes SNP-CpGs...\n")
#Define palette size
palette <- colorRampPalette(colors = palette)(length(unique(
HM450K_cohorts[[i]]$ICGC_Donor_ID)))
if(i %in% c("CLLE-ES", "LIRI-JP", "OV-AU", "PBCA-DE")){ dend.size.row <- -0.5
} else { dend.size.row <- 1 }
snp.htmp <- snp.heatmap(
RnBSet = rnb.set,
annot.grps = list("Donors" = HM450K_cohorts[[i]]$ICGC_Donor_ID),
annot.pal = palette, heatmap.pal = pal_meth,
x.lab = "HM450K samples barcodes", plot.title = paste(
"Methylation heatmap of HM450K genotyping probes in", i, "cohort"),
annot.size = 1.2, dend.size = c(dend.size.row, 2))
#Set width
if(length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) > 30){
if(length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) <= 40 &
length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) >= 31){
plot_width <- 43
} else {
plot_width <- length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) - 5
}
} else { plot_width <- 25 }
#Save heatmap as pdf and png
lapply(X = c("pdf", "png"), FUN = function(frmt){
ggsave(filename = paste(
"Heatmap", "Genotyping", "Probes", "HM450K", paste0(i, ".", frmt),
sep = "_"), plot = snp.htmp, device = frmt,
path = "PCAWG_Paper/graphs/Heatmap_Genotyping_Probes/",
width = plot_width, height = 27, units = "cm", limitsize = FALSE)
})
cat("\tDone.\n")
#!/usr/bin/env Rscript
library("optparse")
opt_parser = OptionParser(description = "
##_Check SNP CpGs Methylation in PCAWG Cohorts_#################################
Version = '0.0.1'
Date = '2020-10-08'
Author = 'Yoann PAGEAUD'
Maintainer = 'Yoann PAGEAUD (yoann.pageaud@gmail.com)'
Dependencies = c('R version 3.6.3 (2019-02-29)',
'RStudio Version 1.2.5019 – © 2009-2019','!!Add dependencies here!!')
Description = 'Use SNP CpGs methylation matrix to assess which samples are from
the same donor.'
################################################################################
");
if (is.null(parse_args(opt_parser)$file) != TRUE){print_help(opt_parser);quit()}
##IMPORTS
# setwd("/run/user/1000/gvfs/sftp:host=odcf-worker01/icgc/dkfzlsdf/analysis/G200/pageaud/PhD/Brors_Lab/")
setwd("/media/yoann/Disque Dur 4/PhD/Brors_Lab/")
Imports = c("BiocompR", "ggsci")
invisible(lapply(Imports, library, character.only = T))
source("PCAWG_Paper/src/handle_PCAWG_cohorts.R")
source("PCAWG_Paper/src/qc_plot.R")
##PARAMETERS
#Load idat PCAWG cohort directories
load_idat_dirs()
#Set donor palette
palette <- pal_npg("nrc", alpha = 1)(10)
#Set methylation palette
pal_meth <- c("#2166AC", "#4393C3", "#92C5DE", "#D1E5F0",
"#FDDBC7", "#F4A582", "#D6604D", "#B2182B")
##ANALYSIS
#TODO: Make left dendrogram smaller for CLLE, LIRI, OV & PBCA
#TODO: Fix Overlapping X-axis labels in PACA.
#TODO: Reduce legend space size in PBCA.
#Make PCAWG cohort annotations
HM450K_cohorts <- make_cohorts_annotations(
pcawg.csv = "PCAWG4_Methylation_Metadata/PCAWG4_ICGC_TCGA.csv",
idat_folder = "PCAWG_Paper/data/HM450K_idat/OV-AU_idats/")
#Save cohort tables as individual annotation files
invisible(lapply(X = seq_along(HM450K_cohorts), FUN = function(i){
fwrite(x = HM450K_cohorts[[i]], file = file.path(
"PCAWG_Paper/data/Cohorts_annotations/", paste(
names(HM450K_cohorts)[i], "annotation.csv", sep = "_")))
}))
invisible(lapply(X = names(HM450K_cohorts), FUN = function(i){
cat(paste0("Cohort ", i, ":\n"))
#Execute data import with RnBeads
rnb.set <- create_cohort_rnbset(cohort.name = i)
cat("\tPlotting methylation heatmap of genotyping probes SNP-CpGs...\n")
#Define palette size
palette <- colorRampPalette(colors = palette)(length(unique(
HM450K_cohorts[[i]]$ICGC_Donor_ID)))
if(i %in% c("CLLE-ES", "LIRI-JP", "OV-AU", "PBCA-DE")){ dend.size.row <- -0.5
} else { dend.size.row <- 1 }
snp.htmp <- snp.heatmap(
RnBSet = rnb.set,
annot.grps = list("Donors" = HM450K_cohorts[[i]]$ICGC_Donor_ID),
annot.pal = palette, heatmap.pal = pal_meth,
x.lab = "HM450K samples barcodes", plot.title = paste(
"Methylation heatmap of HM450K genotyping probes in", i, "cohort"),
annot.size = 1.2, dend.size = c(dend.size.row, 2))
#Set width
if(length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) > 30){
if(length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) <= 40 &
length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) >= 31){
plot_width <- 43
} else {
plot_width <- length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) - 5
}
} else { plot_width <- 25 }
#Save heatmap as pdf and png
lapply(X = c("pdf", "png"), FUN = function(frmt){
ggsave(filename = paste(
"Heatmap", "Genotyping", "Probes", "HM450K", paste0(i, ".", frmt),
sep = "_"), plot = snp.htmp, device = frmt,
path = "PCAWG_Paper/graphs/Heatmap_Genotyping_Probes/",
width = plot_width, height = 27, units = "cm", limitsize = FALSE)
})
cat("\tDone.\n")
}))
# Some issue about the display of probe names when using rnb.plot.snp.heatmap()
# rnb.plot.snp.heatmap(dataset = rnb.set)
length(unique(HM450K_cohorts$`PACA-AU`$ICGC_Donor_ID)
)
#!/usr/bin/env Rscript
library("optparse")
opt_parser = OptionParser(description = "
##_Check SNP CpGs Methylation in PCAWG Cohorts_#################################
Version = '0.0.1'
Date = '2020-10-08'
Author = 'Yoann PAGEAUD'
Maintainer = 'Yoann PAGEAUD (yoann.pageaud@gmail.com)'
Dependencies = c('R version 3.6.3 (2019-02-29)',
'RStudio Version 1.2.5019 – © 2009-2019','!!Add dependencies here!!')
Description = 'Use SNP CpGs methylation matrix to assess which samples are from
the same donor.'
################################################################################
");
if (is.null(parse_args(opt_parser)$file) != TRUE){print_help(opt_parser);quit()}
##IMPORTS
# setwd("/run/user/1000/gvfs/sftp:host=odcf-worker01/icgc/dkfzlsdf/analysis/G200/pageaud/PhD/Brors_Lab/")
setwd("/media/yoann/Disque Dur 4/PhD/Brors_Lab/")
Imports = c("BiocompR", "ggsci")
invisible(lapply(Imports, library, character.only = T))
source("PCAWG_Paper/src/handle_PCAWG_cohorts.R")
source("PCAWG_Paper/src/qc_plot.R")
##PARAMETERS
#Load idat PCAWG cohort directories
load_idat_dirs()
#Set donor palette
palette <- pal_npg("nrc", alpha = 1)(10)
#Set methylation palette
pal_meth <- c("#2166AC", "#4393C3", "#92C5DE", "#D1E5F0",
"#FDDBC7", "#F4A582", "#D6604D", "#B2182B")
##ANALYSIS
#TODO: Make left dendrogram smaller for PBCA
#TODO: Fix Overlapping X-axis labels in PACA.
#TODO: Reduce legend space size in PBCA.
#Make PCAWG cohort annotations
HM450K_cohorts <- make_cohorts_annotations(
pcawg.csv = "PCAWG4_Methylation_Metadata/PCAWG4_ICGC_TCGA.csv",
idat_folder = "PCAWG_Paper/data/HM450K_idat/OV-AU_idats/")
#Save cohort tables as individual annotation files
invisible(lapply(X = seq_along(HM450K_cohorts), FUN = function(i){
fwrite(x = HM450K_cohorts[[i]], file = file.path(
"PCAWG_Paper/data/Cohorts_annotations/", paste(
names(HM450K_cohorts)[i], "annotation.csv", sep = "_")))
}))
invisible(lapply(X = names(HM450K_cohorts), FUN = function(i){
cat(paste0("Cohort ", i, ":\n"))
#Execute data import with RnBeads
rnb.set <- create_cohort_rnbset(cohort.name = i)
cat("\tPlotting methylation heatmap of genotyping probes SNP-CpGs...\n")
#Define palette size
palette <- colorRampPalette(colors = palette)(length(unique(
HM450K_cohorts[[i]]$ICGC_Donor_ID)))
if(i %in% c("CLLE-ES", "LIRI-JP", "OV-AU", "PACA-AU")){ dend.size.row <- -0.5
} else if(i == "PBCA-DE"){
dend.size.row <- -0.7
} else { dend.size.row <- 1 }
snp.htmp <- snp.heatmap(
RnBSet = rnb.set,
annot.grps = list("Donors" = HM450K_cohorts[[i]]$ICGC_Donor_ID),
annot.pal = palette, heatmap.pal = pal_meth,
x.lab = "HM450K samples barcodes", plot.title = paste(
"Methylation heatmap of HM450K genotyping probes in", i, "cohort"),
annot.size = 1.2, dend.size = c(dend.size.row, 2))
#Set width
if(length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) > 30){
if(length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) <= 40 &
length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) >= 31){
plot_width <- 43
} else {
plot_width <- length(unique(HM450K_cohorts[[i]]$ICGC_Donor_ID)) - 5
}
} else { plot_width <- 25 }
#Save heatmap as pdf and png
lapply(X = c("pdf", "png"), FUN = function(frmt){
ggsave(filename = paste(
"Heatmap", "Genotyping", "Probes", "HM450K", paste0(i, ".", frmt),
sep = "_"), plot = snp.htmp, device = frmt,
path = "PCAWG_Paper/graphs/Heatmap_Genotyping_Probes/",
width = plot_width, height = 27, units = "cm", limitsize = FALSE)
})
cat("\tDone.\n")
}))
# Some issue about the display of probe names when using rnb.plot.snp.heatmap()
# rnb.plot.snp.heatmap(dataset = rnb.set)
devtools::document()
devtools::install()
library(data.table)
devtools::document()
devtools::install()
devtools::document()
devtools::install()
devtools::document()
devtools::install()
library(BiocompR)
pca.res <- prcomp(iris[,-5])
ggbipca(prcomp.res = pca.res, data = iris)
devtools::document()
devtools::install()
